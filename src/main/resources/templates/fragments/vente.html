<div class="recherche card shadow-sm border-1 bg-light p-4 mb-4" th:fragment="recherche (recherche)" th:object="${recherche}">
    <form th:action="@{/encheres}" method="post">

        <!-- Barre de recherche -->
        <div class="row g-3 align-items-end mb-4">
            <div class="col-lg-6">
                <label class="form-label fw-semibold text-muted small mb-1">Rechercher</label>
                <input type="search" th:field="*{keywords}" class="form-control form-control-lg" placeholder="Tapez votre recherche..."/>
            </div>
            <div class="col-lg-6">
                <label class="form-label fw-semibold text-muted small mb-1">Catégorie</label>
                <select th:field="*{noCategorie}" class="form-select form-select-lg">
                    <option value="0">Toutes les catégories</option>
                    <option th:each="categorie : ${@categoryService.afficherCategories()}"
                            th:value="${categorie.getNoCategorie()}"
                            th:text="${categorie.getLibelle()}">
                    </option>
                </select>
            </div>
        </div>

        <!-- Filtres Achats/Ventes -->
        <div sec:authorize="isAuthenticated()" class="row g-4">
            <div class="col-lg-6">
                <div class="card border-primary border-2 bg-light-primary p-4 h-100">
                    <div class="h5 mb-4 text-primary fw-bold border-bottom pb-2">Mes Achats</div>

                    <div class="form-check mb-3">
                        <input type="radio" th:field="*{achatOuVente}" th:value="1" id="achat">
                        <label for="achat" class="text-nowrap">Voir toutes mes enchères</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" th:field="*{encheresOuvertes}" value="1" id="encheresOuvertes">
                        <label for="encheresOuvertes" class="text-nowrap">Enchères ouvertes</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" th:field="*{mesEncheres}" value="1" id="mesEncheres">
                        <label for="mesEncheres" class="text-nowrap">Mes enchères en cours</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" th:field="*{mesEncheresRemportees}" value="1" id="mesEncheresRemportees">
                        <label for="mesEncheresRemportees" class="text-nowrap">Enchères remportées</label>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card border-success border-2 bg-light-success p-4 h-100">
                    <div class="h5 mb-4 text-success fw-bold border-bottom pb-2">Mes Ventes</div>

                    <div class="form-check mb-3">
                        <input type="radio" th:field="*{achatOuVente}" th:value="2" id="vente">
                        <label for="vente" class="text-nowrap" >Voir toutes mes ventes</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" th:field="*{mesVentesEnCours}" value="1" id="mesVentesEnCours">
                        <label for="mesVentesEnCours" class="text-nowrap">Ventes en cours</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" th:field="*{mesVentesNonDebutees}" value="1" id="mesVentesNonDebutees">
                        <label for="mesVentesNonDebutees" class="text-nowrap">Ventes en attente</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" th:field="*{mesVentesTerminees}" value="1" id="mesVentesTerminees">
                        <label for="mesVentesTerminees" class="text-nowrap">Ventes terminées</label>
                    </div>
                </div>
            </div>
        </div>
        <!--On sort le bouton en dehors de la zone masquée pour y avoir accés même non connecté -->
        <div class="col-lg-12">
            <button type="submit" class="btn btn-primary btn-lg w-100 h-100">
                <i class="bi bi-search me-2"></i>Rechercher
            </button>
        </div>

    </form>
</div>

<div th:fragment="vente-card (article)" th:classappend="${article.etatVente == 'Non commencée' || article.etatVente == 'Terminée' || article.etatVente == 'Annulée'} ? 'card h-100 opacity-50 bg-light' : 'card h-100'"
     th:style="${article.etatVente == 'Non commencée' && !#strings.equals(article.vendeur.pseudo, #authentication.name)} ? 'pointer-events: none; cursor: not-allowed' : ''">
    <a th:href="@{/vente/{id}(id=${article.noArticle})}" class="text-decoration-none text-dark">
        <img th:src="@{/images/{image}(image=${article.idImage})}"
             class="card-img-top img-fluid"
             style="height: 180px; object-fit: cover;"
             th:alt="${article.nomArticle}">
        <!-- Grand badge -->
        <span th:if="${article.etatVente == 'Non commencée'}" class="position-absolute top-50 start-50 translate-middle badge text-bg-warning fs-6 px-4 py-2 rotate-45">
                        A VENIR
                    </span>
        <span th:if="${article.etatVente == 'Terminée'}" class="position-absolute top-50 start-50 translate-middle badge text-bg-secondary fs-6 px-4 py-2 rotate-45">
                        TERMINÉE
                    </span>
        <span th:if="${article.etatVente == 'Annulée'}" class="position-absolute top-50 start-50 translate-middle badge text-bg-danger fs-6 px-4 py-2 rotate-45">
                        ANNULEE
                    </span>
        <div class="card-body">
            <h5 class="card-title" th:text="${article.nomArticle}">Nom produit</h5>
            <p class="card-text">
                | Prix : <span th:text="${article.prixVente}"></span>
                | Début de l'enchère : <span th:text="${#temporals.format(article.dateDebutEncheres, 'dd/MM/yyyy')}"></span>
                | Fin de l'enchère : <span th:text="${#temporals.format(article.dateFinEncheres, 'dd/MM/yyyy')}"></span>
                | Etat : <span th:text="${article.etatVente}"></span>
                | Vendeur : <span><a th:href="@{/profil/{pseudo}(pseudo=${article.vendeur.pseudo})}" th:text="${article.vendeur.pseudo}"></a></span>
            </p>
        </div>
    </a>
</div>
