<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ENI-Enchères</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="alert alert-warning">
        <p>Note for programming :</p>
        <strong>Etat de la vente :</strong> <span th:text="${article.etatVente}"></span>
    </div>

    <!-- Vente terminée -->
    <th:block th:if="${article.etatVente == 'Terminée'}">
        <th:block th:if="${#strings.equals(meilleureOffre.acheteur.pseudo, #authentication.name)}">
            <h1>Vous avez remporté la vente !</h1>
        </th:block>
        <th:block th:if="${!#strings.equals(meilleureOffre.acheteur.pseudo, #authentication.name)}">
            <h1><span th:text="${meilleureOffre.acheteur.pseudo}"></span> a remporté l'enchère</h1>
        </th:block>
    </th:block>

    <!-- Vente en cours -->
    <th:block th:if="${article.etatVente == 'En cours'}">
        <h1>Détails vente</h1>
    </th:block>

    <th:block th:if="${article.etatVente == 'En cours' || article.etatVente == 'Terminée'}">
        <!-- Une vente non commencée n'est visible que par le vendeur -->
        <div>
            <p>Article : <span th:text="${article.nomArticle}"></span></p>
            <p>Description : <span th:text="${article.description}"></span></p>
            <p>Catégorie : <span th:text="${article.categorie.libelle}"></span></p>
            <p>Meilleure offre :
                <span th:text="${meilleureOffre.montantEnchere}"></span>
                points par
                <a th:href="@{/profil}" th:text="${meilleureOffre.acheteur.pseudo}"></a>
            </p>
            <p>Mise à prix : <span th:text="${article.prixInitial}"></span> points</p>
            <p>Fin de l'enchère : <span th:text="${#temporals.format(article.dateFinEncheres, 'dd/MM/yyyy')}"></span></p>
            <p>
                <span>Retrait: </span>
                <span th:text="${article.retrait?.rue} ?: ''">
                    <p> <span th:text="${article.retrait?.codePostal} ?: ''"></span>
                        <span th:text="${article.retrait?.ville} ?: ''"></span>
                    </p>
                </span>
            </p>
            <p>Vendeur :
                <a th:href="@{/profil}" th:text="${article.vendeur.pseudo}"></a>
            </p>

            <!-- Un acheteur peut enchérir tant que la vente est encore en cours -->
            <form th:if="${article.etatVente == 'En cours'}" th:action="@{/vente/{id}/encherir(id=${article.noArticle})}" method="POST">
                <p>Ma proposition :
                    <input th:if="${monOffre == null}" type="number" name="nouveauMontantEnchere" th:value="0" required min="10" step="10">
                    <input th:if="${monOffre != null}" type="number" name="nouveauMontantEnchere" th:value="${monOffre.montantEnchere}" required min="10" step="10">
                    points
                    <input type="submit" value="Enchérir">
                </p>
            </form>

<!--             Si la vente est terminée, impossible de renchérir -->
            <div th:if="${article.etatVente == 'Terminée'}">
                <div th:if="${monOffre != null}">
                    <span>Ma proposition :
                        <span th:text="${monOffre.montantEnchere}"></span>
                        points
                    </span>
                </div>
            </div>
        </div>
    </th:block>
</body>
</html>